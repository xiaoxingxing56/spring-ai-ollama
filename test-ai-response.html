<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI 回复解析测试</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .message {
            margin-bottom: 20px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        
        .message-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }
        
        .message-content {
            flex: 1;
            padding: 12px 16px;
            border-radius: 18px;
            background: white;
            border: 1px solid #e0e0e0;
            border-bottom-left-radius: 4px;
        }
        
        .ai-thinking {
            background: #f0f8ff !important;
            border: 1px solid #b3d9ff !important;
            border-bottom-left-radius: 4px;
            margin-bottom: 8px;
            padding: 12px;
        }
        
        .ai-thinking-header {
            font-size: 12px;
            color: #0066cc;
            font-weight: 600;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .ai-thinking-content {
            font-size: 13px;
            color: #555;
            line-height: 1.4;
            font-style: italic;
        }
        
        .ai-thinking-icon {
            width: 16px;
            height: 16px;
            background: #0066cc;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 10px;
        }
        
        .message-time {
            font-size: 11px;
            color: #999;
            margin-top: 4px;
        }
        
        .test-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .test-button:hover {
            background: #5a6fd8;
        }
        
        .raw-response {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 15px;
            margin-top: 10px;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>🤖 AI 回复解析测试</h1>
    
    <div class="test-container">
        <h3>测试用例</h3>
        <button class="test-button" onclick="testCase1()">测试用例1: 包含思考过程</button>
        <button class="test-button" onclick="testCase2()">测试用例2: 简单回复</button>
        <button class="test-button" onclick="testCase3()">测试用例3: 复杂思考</button>
        <button class="test-button" onclick="clearTest()">清除测试</button>
    </div>
    
    <div id="testResults"></div>
    
    <script>
        function parseAIResponse(response) {
            // 检查是否包含思考过程（通常在 <think> 标签中）
            const thinkMatch = response.match(/<think>([\s\S]*?)<\/think>/i);
            
            if (thinkMatch) {
                const thinking = thinkMatch[1].trim();
                const finalResponse = response.replace(/<think>[\s\S]*?<\/think>/gi, '').trim();
                return { thinking, finalResponse };
            }
            
            // 如果没有明确的思考标签，尝试其他模式
            const lines = response.split('\n');
            const thinkingLines = [];
            const responseLines = [];
            let inThinking = false;
            
            for (const line of lines) {
                const trimmedLine = line.trim();
                
                // 检测思考过程的开始
                if (trimmedLine.toLowerCase().includes('think') || 
                    trimmedLine.toLowerCase().includes('思考') ||
                    trimmedLine.toLowerCase().includes('分析') ||
                    trimmedLine.toLowerCase().includes('考虑')) {
                    inThinking = true;
                    thinkingLines.push(trimmedLine);
                    continue;
                }
                
                // 检测思考过程的结束
                if (inThinking && (trimmedLine.includes('</think>') || 
                    trimmedLine.includes('因此') || 
                    trimmedLine.includes('所以') ||
                    trimmedLine.includes('总结'))) {
                    inThinking = false;
                    responseLines.push(trimmedLine);
                    continue;
                }
                
                if (inThinking) {
                    thinkingLines.push(trimmedLine);
                } else {
                    responseLines.push(trimmedLine);
                }
            }
            
            const thinking = thinkingLines.join('\n').trim();
            const finalResponse = responseLines.join('\n').trim();
            
            return { thinking, finalResponse };
        }
        
        function addAIResponse(response, title) {
            const resultsDiv = document.getElementById('testResults');
            
            const container = document.createElement('div');
            container.className = 'test-container';
            
            const titleDiv = document.createElement('h4');
            titleDiv.textContent = title;
            container.appendChild(titleDiv);
            
            const messageDiv = document.createElement('div');
            messageDiv.className = 'message';
            
            const avatar = document.createElement('div');
            avatar.className = 'message-avatar';
            avatar.textContent = 'AI';
            
            const messageContent = document.createElement('div');
            messageContent.className = 'message-content';
            
            // 解析AI回复，分离思考过程和最终回复
            const { thinking, finalResponse } = parseAIResponse(response);
            
            // 如果有思考过程，先显示思考内容
            if (thinking) {
                const thinkingDiv = document.createElement('div');
                thinkingDiv.className = 'ai-thinking';
                
                const thinkingHeader = document.createElement('div');
                thinkingHeader.className = 'ai-thinking-header';
                thinkingHeader.innerHTML = `
                    <div class="ai-thinking-icon">💭</div>
                    AI 思考过程
                `;
                
                const thinkingContent = document.createElement('div');
                thinkingContent.className = 'ai-thinking-content';
                thinkingContent.textContent = thinking;
                
                thinkingDiv.appendChild(thinkingHeader);
                thinkingDiv.appendChild(thinkingContent);
                messageContent.appendChild(thinkingDiv);
            }
            
            // 显示最终回复
            const finalResponseDiv = document.createElement('div');
            finalResponseDiv.textContent = finalResponse;
            
            const messageTime = document.createElement('div');
            messageTime.className = 'message-time';
            messageTime.textContent = new Date().toLocaleTimeString();
            
            finalResponseDiv.appendChild(messageTime);
            messageContent.appendChild(finalResponseDiv);
            
            messageDiv.appendChild(avatar);
            messageDiv.appendChild(messageContent);
            container.appendChild(messageDiv);
            
            // 显示原始响应
            const rawDiv = document.createElement('div');
            rawDiv.className = 'raw-response';
            rawDiv.textContent = '原始响应:\n' + response;
            container.appendChild(rawDiv);
            
            resultsDiv.appendChild(container);
        }
        
        function testCase1() {
            const response = `<think>
Okay, the user asked "什么是人工智能". I need to provide a comprehensive explanation of artificial intelligence.

First, I should define what AI is - the simulation of human intelligence by machines. Then I should explain the key components like machine learning, neural networks, and deep learning.

I should also mention the different types of AI: narrow AI (specific tasks) and general AI (human-like intelligence). It's important to give examples of AI applications in daily life.

I should structure the response clearly, starting with a definition, then explaining the types, and finally giving examples. Keep it accessible but informative.
</think>

人工智能（Artificial Intelligence，简称AI）是计算机科学的一个分支，旨在创建能够模拟人类智能行为的系统。

**主要类型：**
1. **狭义AI（Narrow AI）**：专注于特定任务，如语音识别、图像处理
2. **通用AI（General AI）**：具备人类般的通用智能（仍在发展中）

**核心技术：**
- 机器学习（Machine Learning）
- 深度学习（Deep Learning）
- 神经网络（Neural Networks）

**应用领域：**
- 语音助手（如Siri、Alexa）
- 自动驾驶汽车
- 医疗诊断
- 推荐系统

AI正在改变我们的生活方式，但仍在快速发展中。`;
            
            addAIResponse(response, '测试用例1: 包含思考过程的AI回复');
        }
        
        function testCase2() {
            const response = `你好！我是AI助手，很高兴为你服务。我可以帮助你回答问题、提供信息或进行对话交流。有什么我可以帮助你的吗？`;
            
            addAIResponse(response, '测试用例2: 简单回复（无思考过程）');
        }
        
        function testCase3() {
            const response = `<think>
用户问了一个关于天气的问题。我需要考虑几个方面：

1. 首先，我没有实时的天气数据访问权限
2. 我应该诚实地告诉用户我的限制
3. 我可以提供一些关于如何获取天气信息的建议
4. 保持友好和有用的态度

让我组织一个清晰的回复，先承认我的限制，然后提供有用的建议。
</think>

抱歉，我无法提供实时的天气信息，因为我没有访问当前天气数据的能力。

不过，我可以建议你：
- 查看手机上的天气应用
- 访问天气网站如天气通、墨迹天气
- 使用语音助手询问天气

如果你有其他问题，我很乐意帮助你！`;
            
            addAIResponse(response, '测试用例3: 复杂思考过程');
        }
        
        function clearTest() {
            document.getElementById('testResults').innerHTML = '';
        }
    </script>
</body>
</html> 